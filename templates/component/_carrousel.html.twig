

<script>
// définition var du caroussel
const nbr={{ spot.pictures|length }};
var p=0;
if(document.getElementById("carrouselContainer")){

    const carrousselContainer = document.getElementById("carrouselContainer");
    const boutonCarrouselDroite = document.getElementById("boutonCarrouselDroite");
    const boutonCarrouselGauche = document.getElementById("boutonCarrouselGauche");
    // appel de fonctions au chargement de la page
    afficherMasquerChevronCarrousel();
    
    document.body.onload = function() {
        carrouselContainer.style.width = (800 * nbr) + "px";
    
        // Pour chaques images de spot
        {% for image in spot.pictures %}
            (function() {
                // instancie une div
                var div = document.createElement("div");
                // lui ajouter une classe
                div.className = "photo-spot";
                
                // lui ajouter un background image
                div.style.backgroundImage = "url('{{asset('assets/uploads/photos-spot/' ~ image.name)}}')";

                // lui attribuer un aria-label
                div.setAttribute('aria-label', 'Photo du spot');

                // ajouter la div #carrouselContainer 
                carrouselContainer.appendChild(div);

                // MODALE 
                // onclick sur la div du carrousel
                div.onclick = function() {
                    // ref à modal html 
                    var modal = document.getElementById("imageModal");
                    //ref a image du modal
                    var modalImg = document.getElementById("modalImage");
                    // ajout du display block sur le modal
                    modal.style.display = "flex";
                    // ajoute la source
                    modalImg.src = this.style.backgroundImage.slice(5, -2); // Enlever 'url(' et ')'

                    // redimensionenr image
                    modalImg.style.maxWidth = "100%";
                    modalImg.style.maxHeight = "100%";
                    modalImg.style.minHeight= "100%";

                    // Ajout du gestionnaire d'événement pour fermer le modale en cliquant sur l'image
                    modalImg.onclick = function() {
                        modal.style.display = "none";
                    };
                };
    
                {% if is_granted('ROLE_ADMIN')%}
                    
                var deleteLink = document.createElement("a");
                deleteLink.className = "delete-button";
                deleteLink.href = "#";
                deleteLink.textContent = "Supprimer";
    
                deleteLink.addEventListener("click", function(event) {
                    event.preventDefault();
                    
                    if (deleteLink.textContent === "Supprimer") {
                        deleteLink.textContent = "Sûr?";
                        deleteLink.classList.add("delete-button-confirm");
                    } else if (deleteLink.textContent === "Sûr?") {
                        window.location.href = "{{ path('deletePicture_admin', {'idSpot': spot.id, 'idPic': image.id}) }}";
                    }
                });
                div.appendChild(deleteLink);
                {% endif %}
            })();
        {% endfor %}
    }

    // Pour fermer le modale
    // reference a .close 
    var span = document.getElementsByClassName("close")[0];

    // onlick sur .close 
    span.onclick = function() {
        // ref a #imageModal
        var modal = document.getElementById("imageModal");
        // ajoute display:none;
        modal.style.display = "none";
    };

    
    boutonCarrouselDroite.onclick=function(){
        if(p > -nbr +1){
            p--;
            carrousselContainer.style.transform="translate("+p*800+"px)";
            carrousselContainer.style.transition="all 0.5s ease";
            
            afficherMasquerChevronCarrousel();
        }
    }
    boutonCarrouselGauche.onclick=function(){
        if(p < 0){
            p++;
            carrousselContainer.style.transform="translate("+p*800+"px)";
            carrousselContainer.style.transition="all 0.5s ease";
            
            afficherMasquerChevronCarrousel();
        }
    
    }
    
    function afficherMasquerChevronCarrousel(){
        if(p == -nbr+1){
            boutonCarrouselDroite.style.visibility="hidden";
        }else{
            boutonCarrouselDroite.style.visibility="visible";
        }
        if(p == 0){
            boutonCarrouselGauche.style.visibility="hidden";
        }else{
            boutonCarrouselGauche.style.visibility="visible";
        }
}
}
</script>