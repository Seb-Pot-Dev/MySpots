
{% extends 'base.html.twig' %}

{% block title %}Hello SpotController!{% endblock %}

{% block body %}
<link rel="stylesheet" href="{{ asset('css/showSpot.css') }}">
<link rel="stylesheet" href="{{ asset('css/carrousel.css') }}">
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

    <!--nom du spot-->
    <h1>{{ spot.name }}</h1>
        <!--affichage note du spot-->
        <p>avgNote : 
            {% if spot.avgNote %}

                {% set avgNote = spot.avgNote %}

                    <!-- Affichage des étoiles -->
                    {% set fullStarsCount = avgNote | round %}

                    {% set roundedAvgNote = avgNote | round %}
                    {% set roundedSupavgNote = avgNote | round(1, 'ceil') %}

                    {% for i in 1..(roundedAvgNote - (roundedAvgNote != roundedSupavgNote ? 1 : 0)) %}
                        <i class="fa-solid fa-star"></i>
                    {% endfor %}

                    {% if roundedAvgNote != roundedSupavgNote %}
                            <i class="fa-solid fa-star-half-stroke"></i>
                    {% endif %}
                    
                    {% if roundedAvgNote < 5 %}
                        
                        {% for i in 1..(5 - roundedAvgNote ) %}
                            <i class="fa-regular fa-star"></i>
                        {% endfor %}

                    {% endif %}
            <!--affichage de la avgNote-->
                ({{spot.avgNote}})
                ({{spot.notations|length}} évaluations)
            {% else %}
                Pas encore de avgNote
            {% endif %}
        </p>
        
            <!--form note du spot -->
            {{ form(formNotation) }}

            <!--nombre de like du spot-->
            <p>Nombre de like : {{ spot.favoritedByUsers | length }} </p>

<!-- carrousel -->
<div id="carrousel">
    <div id="carrouselContainer">
    </div>

<svg height="800px" width="800px" version="1.1" class="bouton-carrousel" id="boutonCarrouselGauche" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 185.343 185.343" xml:space="preserve">
<g>
	<g>
		<path style="fill:#010002;" d="M51.707,185.343c-2.741,0-5.493-1.044-7.593-3.149c-4.194-4.194-4.194-10.981,0-15.175
			l74.352-74.347L44.114,18.32c-4.194-4.194-4.194-10.987,0-15.175c4.194-4.194,10.987-4.194,15.18,0l81.934,81.934
			c4.194,4.194,4.194,10.987,0,15.175l-81.934,81.939C57.201,184.293,54.454,185.343,51.707,185.343z"/>
	</g>
</g>
</svg>

<svg height="800px" width="800px" version="1.1" class="bouton-carrousel" id="boutonCarrouselDroite" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 185.343 185.343" xml:space="preserve">
<g>
	<g>
		<path style="fill:#010002;" d="M51.707,185.343c-2.741,0-5.493-1.044-7.593-3.149c-4.194-4.194-4.194-10.981,0-15.175
			l74.352-74.347L44.114,18.32c-4.194-4.194-4.194-10.987,0-15.175c4.194-4.194,10.987-4.194,15.18,0l81.934,81.934
			c4.194,4.194,4.194,10.987,0,15.175l-81.934,81.939C57.201,184.293,54.454,185.343,51.707,185.343z"/>
	</g>
</g>
</svg>

    
</div>
    {# <p>Photos:<p>
    <!-- Si il y a + que 0 photos pour ce spot -->
    {% if spot.pictures|length > 0 %}
    <ul>
        {% for image in spot.pictures %}
        <li>
            <img class="image-show-spot" src="{{asset('assets/uploads/photos-spot/' ~ image.name)}}"></img>
        </li>
        {% endfor %}
    <!-- Sinon -->
    </ul>
    {% else %}
        <p>Pas de photos ajoutées pour ce spot</p>
    {% endif %} #}
</div>








    <!--description du spot-->
    <p>Description: {{ spot.description }}
    </p>

<!--ressources du spot-->
<h4>Ressources sur place:</h4>

{% if spot.modules|length >= 1 %}
<ul>
{% for module in spot.modules %}
    <li> {{ module.name }} </li>
{% endfor %}
</ul>
{% else %}
Les informations concernant les ressources de ce spot n'ont pas encore été renseignées.
{% endif %}

<!--commentaires du spot-->
<h4>Commentaires:</h4>
{% if spot.comments|length >= 1 %}
    <!-- boucle sur les commentaires du spot, triés par date -->
    {% for comment in spot.comments|sort((a, b)=>a.date<=>b.date) %}
    <div class="comment-box">
        <div class="comment-author-and-date">
        {{comment.author.pseudo}}
        {{comment.date|date('d/m/y H:i:s')}}
        </div>
        <div class="comment-content">
        {{comment.content}}
        </div>
    </div>
    {% endfor %}
{% else %}
<p>Pas encore de commentaire sur ce spot</p>
{% endif %}

{% if app.user %}
{{ form(formCommentSpot) }}
{% else %}
<p>Veuillez vous connecter pour pouvoir commenter un spot.</p>
{% endif %}
</div>

<script>

// définition var du caroussel
const nbr={{ spot.pictures|length }};
var p=0;
const carrousselContainer = document.getElementById("carrouselContainer");
const boutonCarrouselDroite = document.getElementById("boutonCarrouselDroite");
const boutonCarrouselGauche = document.getElementById("boutonCarrouselGauche");
// appel de fonctions au chargement de la page
afficherMasquerChevronCarrousel();

// Pour le carrousel:
document.body.onload=function(){
    carrouselContainer.style.width = (800*nbr)+"px";

{% for image in spot.pictures %}
    var div = document.createElement("div");
    div.className = "photo-spot";
    div.style.backgroundImage = "url('{{asset('assets/uploads/photos-spot/' ~ image.name)}}')";
    carrouselContainer.appendChild(div);
{% endfor %}
}   
boutonCarrouselDroite.onclick=function(){
    if(p > -nbr +1){
        p--;
        carrousselContainer.style.transform="translate("+p*800+"px)";
        carrousselContainer.style.transition="all 0.5s ease";
        
        afficherMasquerChevronCarrousel();
    }
}
boutonCarrouselGauche.onclick=function(){
    if(p < 0){
        p++;
        carrousselContainer.style.transform="translate("+p*800+"px)";
        carrousselContainer.style.transition="all 0.5s ease";
        
        afficherMasquerChevronCarrousel();
    }

}

function afficherMasquerChevronCarrousel(){
    if(p == -nbr+1){
        boutonCarrouselDroite.style.visibility="hidden";
    }else{
        boutonCarrouselDroite.style.visibility="visible";
    }
    if(p == 0){
        boutonCarrouselGauche.style.visibility="hidden";
    }else{
        boutonCarrouselGauche.style.visibility="visible";
    }
}
</script>
{% endblock %}